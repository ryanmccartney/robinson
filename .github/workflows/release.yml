# .github/workflows/release.yml
name: Release

on: workflow_dispatch

jobs:
    checkout:
      runs-on: ubuntu-latest
      steps:
        - name: Checkout source code
          uses: actions/checkout@v4
    git-setup:
      runs-on: ubuntu-latest
      needs: checkout
      defaults:
        run:
          working-directory: ./robinson
      steps:
        - name: Initialize Git user
          run: |
            git config --global user.email "ryan@mccartney.info"
            git config --global user.name "Release Workflow"
        - name: Log git status
          run: git status
    backend-install:
      runs-on: ubuntu-latest
      needs: git-setup
      defaults:
        run:
          working-directory: ./backend
      steps:
        - name: Install the dependencies
          run: npm ci
    release:
      runs-on: ubuntu-latest
      needs: backend-install
      defaults:
        run:
          working-directory: ./backend
      steps:
        - name: Run release
          run: npm run release --ci
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}